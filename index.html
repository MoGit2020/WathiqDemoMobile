<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wathiq.om</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Kufi+Arabic:wght@400;700&family=Dancing+Script:wght@700&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Kufi Arabic', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        .mobile-sheet {
            position: fixed; bottom: 0; left: 0; right: 0; background: white; 
            border-top-left-radius: 1.5rem; border-top-right-radius: 1.5rem; 
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1); z-index: 50; 
            transition: transform 0.3s ease-out; max-height: 90vh; overflow-y: auto;
        }
        .desktop-modal {
            position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 50; padding: 1rem;
        }
        .desktop-modal-content {
            background: white; border-radius: 0.75rem; shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%; max-width: 56rem; max-height: 90vh; overflow-y: auto; position: relative;
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Contract Styling */
        .paper-texture { background-color: #fff; background-image: radial-gradient(#f1f5f9 1px, transparent 1px); background-size: 20px 20px; }
        .typewriter { font-family: 'Space Mono', monospace; color: #2563eb; background-color: #eff6ff; padding: 2px 4px; border-radius: 4px; }
        .signature-font { font-family: 'Dancing Script', cursive; font-size: 1.8rem; }
        .stamp-active { opacity: 0.9; transform: scale(1) rotate(-12deg); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 h-screen flex flex-col overflow-hidden">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- DATA ---
        const TENANT = { name: "Sara Khan", id: "CV99281", mobile: "99887766", email: "sara.khan@gmail.com", avatar: "https://ui-avatars.com/api/?name=Sara+Khan&background=db2777&color=fff", rating: 4.8, sector: "Private (PDO)", nationality: "Expat" };
        const LANDLORDS = {
            'Ahmed': { name: "Ahmed Al-Harthi", id: "CV111", mobile: "99112233", avatar: "https://ui-avatars.com/api/?name=Ahmed+Harthi&background=0f172a&color=fff", rating: 4.9, verified: true },
            'Salim': { name: "Salim Al-Alawi", id: "CV222", mobile: "99223344", avatar: "https://ui-avatars.com/api/?name=Salim+Alawi&background=1e293b&color=fff", rating: 4.7, verified: true },
            'Said': { name: "Said Al-Mamari", id: "CV333", mobile: "99334455", avatar: "https://ui-avatars.com/api/?name=Said+Mamari&background=334155&color=fff", rating: 4.5, verified: true },
            'Khlfan': { name: "Khlfan Al-Siyabi", id: "CV444", mobile: "99445566", avatar: "https://ui-avatars.com/api/?name=Khlfan+Siyabi&background=475569&color=fff", rating: 4.2, verified: false }
        };
        const PROPERTIES = [
            { id: 1, landlord: 'Ahmed', title: "Sea View 2BHK", price: 600, beds: 2, baths: 3, area: 145, loc: "Al Mouj, Marsa 1", img: "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=800&q=80", type: "Apartment" },
            { id: 2, landlord: 'Salim', title: "Muscat Hills Villa", price: 950, beds: 4, baths: 5, area: 350, loc: "Muscat Hills", img: "https://images.unsplash.com/photo-1600596542815-2250651d2116?auto=format&fit=crop&w=800&q=80", type: "Villa" },
            { id: 3, landlord: 'Said', title: "Azaiba Studio", price: 300, beds: 1, baths: 1, area: 75, loc: "Azaiba North", img: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=800&q=80", type: "Studio" },
            { id: 4, landlord: 'Khlfan', title: "Family Apt", price: 450, beds: 3, baths: 3, area: 180, loc: "Bausher Heights", img: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?auto=format&fit=crop&w=800&q=80", type: "Apartment" },
            { id: 5, landlord: 'Ahmed', title: "Beachfront Villa", price: 1200, beds: 5, baths: 6, area: 450, loc: "Shatti Al Qurum", img: "https://images.unsplash.com/photo-1613977257363-707ba9348227?auto=format&fit=crop&w=800&q=80", type: "Villa" },
            { id: 6, landlord: 'Salim', title: "City Apt", price: 500, beds: 2, baths: 2, area: 120, loc: "Qurum", img: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?auto=format&fit=crop&w=800&q=80", type: "Apartment" },
            { id: 7, landlord: 'Said', title: "Student Flat", price: 250, beds: 1, baths: 1, area: 60, loc: "Al Khoud", img: "https://images.unsplash.com/photo-1502005229766-3c8ef56462b1?auto=format&fit=crop&w=800&q=80", type: "Flat" },
            { id: 8, landlord: 'Khlfan', title: "Cozy 2BHK", price: 350, beds: 2, baths: 2, area: 110, loc: "Seeb", img: "https://images.unsplash.com/photo-1484154218962-a1c002085d2f?auto=format&fit=crop&w=800&q=80", type: "House" },
            { id: 9, landlord: 'Ahmed', title: "Commercial Space", price: 700, beds: 0, baths: 1, area: 200, loc: "Ruwi CBD", img: "https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=800&q=80", type: "Office" }
        ];

        // --- COMPONENTS ---

        const Navbar = ({ role, setRole, setView }) => (
            <div className={`px-4 py-3 flex justify-between items-center shadow-sm z-30 transition-colors duration-500 ${role==='Landlord'?'bg-slate-900 text-white':'bg-white text-slate-800'}`}>
                <div className="flex items-center gap-2 font-bold text-lg cursor-pointer" onClick={() => setView('home')}>
                    <i className={`fas fa-shield-alt ${role==='Landlord'?'text-blue-500':'text-emerald-500'}`}></i> Wathiq.om
                </div>
                <div className="flex gap-2">
                    <button onClick={() => setRole('Tenant')} className={`text-[10px] font-bold px-3 py-1 rounded-full border ${role==='Tenant'?'bg-emerald-100 border-emerald-500 text-emerald-700':'border-slate-500 text-slate-400'}`}>Tenant</button>
                    <button onClick={() => setRole('Landlord')} className={`text-[10px] font-bold px-3 py-1 rounded-full border ${role==='Landlord'?'bg-blue-900 border-blue-500 text-blue-300':'border-slate-200 text-slate-400'}`}>Landlord</button>
                </div>
            </div>
        );

        const BottomNav = ({ view, setView, role }) => (
            <div className={`md:hidden fixed bottom-0 w-full border-t flex justify-around items-center pb-6 pt-3 z-30 safe-area-bottom transition-colors duration-500 ${role==='Landlord'?'bg-slate-900 border-slate-800 text-slate-400':'bg-white border-slate-100 text-slate-400'}`}>
                <button onClick={() => setView('home')} className={`flex flex-col items-center ${view==='home' ? (role==='Landlord'?'text-blue-400':'text-emerald-600') : ''}`}>
                    <i className="fas fa-home text-xl mb-1"></i><span className="text-[10px] font-medium">Home</span>
                </button>
                <button onClick={() => setView('apps')} className={`flex flex-col items-center ${view==='apps' ? (role==='Landlord'?'text-blue-400':'text-emerald-600') : ''}`}>
                    <i className={`fas ${role==='Landlord'?'fa-bell':'fa-file-contract'} text-xl mb-1`}></i><span className="text-[10px] font-medium">{role==='Landlord'?'Requests':'My Apps'}</span>
                </button>
                <button className="flex flex-col items-center opacity-50">
                    <i className="fas fa-user text-xl mb-1"></i><span className="text-[10px] font-medium">Profile</span>
                </button>
            </div>
        );

        const PropertyCard = ({ p, onClick, role }) => (
            <div onClick={() => onClick(p)} className={`rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition cursor-pointer group ${role==='Landlord'?'bg-slate-800 border border-slate-700':'bg-white border border-slate-100'}`}>
                <div className="h-40 relative overflow-hidden">
                    <img src={p.img} className="w-full h-full object-cover group-hover:scale-105 transition duration-500" />
                    <div className="absolute bottom-2 left-2 bg-slate-900/90 text-white px-2 py-1 rounded-md text-xs font-bold">{p.price} OMR</div>
                    {role === 'Tenant' && <div className="absolute top-2 right-2 bg-white/95 px-2 py-1 rounded-full text-[10px] font-bold text-emerald-700 flex items-center gap-1 shadow"><i className="fas fa-check-circle"></i> Verified</div>}
                </div>
                <div className="p-4">
                    <div className="flex justify-between items-start mb-2">
                        <div>
                            <h3 className={`font-bold text-base truncate ${role==='Landlord'?'text-white':'text-slate-800'}`}>{p.title}</h3>
                            <p className="text-xs text-slate-500 truncate"><i className="fas fa-map-marker-alt mr-1"></i> {p.loc}</p>
                        </div>
                    </div>
                    <div className="flex justify-between text-xs text-slate-500 border-t border-slate-100/10 pt-3">
                        <span className="flex items-center gap-1"><i className="fas fa-bed"></i> {p.beds}</span>
                        <span className="flex items-center gap-1"><i className="fas fa-bath"></i> {p.baths}</span>
                        <span className="flex items-center gap-1"><i className="fas fa-ruler-combined"></i> {p.area}m²</span>
                    </div>
                </div>
            </div>
        );

        // --- THE DETAILED CONTRACT (Responsive) ---
        const ContractView = ({ p, role, signed, onSign, autoFill, onAction, onClose }) => {
            const [fields, setFields] = useState({});
            
            useEffect(() => {
                if(autoFill) {
                    const data = {
                        l_name: LANDLORDS[p.landlord].name, l_id: "1092882", l_mob: LANDLORDS[p.landlord].mobile,
                        t_name: TENANT.name, t_id: TENANT.id, t_mob: TENANT.mobile,
                        rent: p.price + " OMR", loc: p.loc, type: p.type,
                        elec: "2021-99-11", water: "W-8821"
                    };
                    let delay = 300;
                    Object.keys(data).forEach(k => { setTimeout(() => setFields(prev => ({...prev, [k]: data[k]})), delay); delay+=150; });
                } else {
                    setFields({ 
                        l_name: LANDLORDS[p.landlord].name, l_id: "1092882", l_mob: LANDLORDS[p.landlord].mobile,
                        t_name: TENANT.name, t_id: TENANT.id, t_mob: TENANT.mobile,
                        rent: p.price + " OMR", loc: p.loc, type: p.type,
                        elec: "2021-99-11", water: "W-8821"
                    });
                }
            }, []);

            return (
                <div className="flex flex-col h-full bg-white paper-texture">
                    <div className="p-4 border-b flex justify-between items-center bg-white sticky top-0 z-10">
                        <div><h2 className="font-bold text-lg">Lease Contract</h2><div className="text-[10px] text-emerald-600 font-mono">#WQ-2026-881</div></div>
                        <button onClick={onClose} className="bg-gray-100 p-2 rounded-full hover:bg-gray-200"><i className="fas fa-times"></i></button>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto p-6 space-y-6">
                        {/* Header Image */}
                        <div className="flex justify-between items-center opacity-80 mb-6">
                            <div className="text-xs font-bold text-center">SULTANATE OF OMAN<br/>MUSCAT MUNICIPALITY</div>
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/Emblem_of_Oman.svg/1200px-Emblem_of_Oman.svg.png" className="h-12" />
                            <div className="text-xs font-bold text-center font-arabic">سلطنة عمان<br/>بلدية مسقط</div>
                        </div>

                        {/* 1. Landlord */}
                        <div className="border border-slate-300 rounded overflow-hidden">
                            <div className="bg-slate-100 p-2 text-xs font-bold border-b flex justify-between"><span>1. LESSOR (LANDLORD)</span><span className="font-arabic">المؤجر</span></div>
                            <div className="p-3 grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                                <div><div className="text-gray-500 uppercase text-[9px]">Name</div><div className={`font-bold ${fields.l_name && autoFill && 'typewriter'}`}>{fields.l_name}</div></div>
                                <div className="grid grid-cols-2 gap-2">
                                    <div><div className="text-gray-500 uppercase text-[9px]">ID No</div><div className={`font-bold ${fields.l_id && autoFill && 'typewriter'}`}>{fields.l_id}</div></div>
                                    <div><div className="text-gray-500 uppercase text-[9px]">Mobile</div><div className={`font-bold ${fields.l_mob && autoFill && 'typewriter'}`}>{fields.l_mob}</div></div>
                                </div>
                            </div>
                        </div>

                        {/* 2. Tenant */}
                        <div className="border border-blue-200 rounded overflow-hidden">
                            <div className="bg-blue-50 p-2 text-xs font-bold border-b border-blue-200 flex justify-between items-center">
                                <span>2. TENANT (INVESTOR)</span>
                                {autoFill && <span className="text-[9px] bg-blue-200 text-blue-800 px-2 rounded animate-pulse">Auto-Filling from Mala'a...</span>}
                            </div>
                            <div className="p-3 grid grid-cols-1 md:grid-cols-2 gap-4 text-xs">
                                <div><div className="text-gray-500 uppercase text-[9px]">Name</div><div className={`font-bold ${fields.t_name && autoFill && 'typewriter'}`}>{fields.t_name}</div></div>
                                <div className="grid grid-cols-2 gap-2">
                                    <div><div className="text-gray-500 uppercase text-[9px]">Civil ID</div><div className={`font-bold ${fields.t_id && autoFill && 'typewriter'}`}>{fields.t_id}</div></div>
                                    <div><div className="text-gray-500 uppercase text-[9px]">Mobile</div><div className={`font-bold ${fields.t_mob && autoFill && 'typewriter'}`}>{fields.t_mob}</div></div>
                                </div>
                            </div>
                        </div>

                        {/* 3. Property */}
                        <div className="border border-slate-300 rounded overflow-hidden">
                            <div className="bg-slate-100 p-2 text-xs font-bold border-b flex justify-between"><span>3. LEASED PROPERTY</span><span className="font-arabic">العقار المؤجر</span></div>
                            <div className="p-3 grid grid-cols-2 gap-4 text-xs">
                                <div><div className="text-gray-500 uppercase text-[9px]">Location</div><div className={`font-bold ${fields.loc && autoFill && 'typewriter'}`}>{fields.loc}</div></div>
                                <div><div className="text-gray-500 uppercase text-[9px]">Type</div><div className={`font-bold ${fields.type && autoFill && 'typewriter'}`}>{fields.type}</div></div>
                                <div><div className="text-gray-500 uppercase text-[9px]">Elec Acc</div><div className={`font-bold ${fields.elec && autoFill && 'typewriter'}`}>{fields.elec}</div></div>
                                <div><div className="text-gray-500 uppercase text-[9px]">Water Acc</div><div className={`font-bold ${fields.water && autoFill && 'typewriter'}`}>{fields.water}</div></div>
                            </div>
                            <div className="border-t p-3 bg-emerald-50 flex justify-between items-center">
                                <span className="text-xs font-bold text-emerald-800">AGREED RENT</span>
                                <span className={`text-lg font-bold text-emerald-600 ${fields.rent && autoFill && 'typewriter'}`}>{fields.rent}</span>
                            </div>
                        </div>
                    </div>

                    <div className="p-4 border-t bg-white safe-bottom">
                        <div className="flex gap-4 mb-4">
                            <div className="flex-1 text-center p-2 border rounded border-dashed border-slate-300 bg-slate-50">
                                <div className="text-[9px] uppercase text-slate-400">Lessor</div>
                                {role==='Landlord' && !signed ? 
                                    <button onClick={onSign} className="text-xs bg-blue-600 text-white px-3 py-1 rounded mt-1">Sign</button> : 
                                    <div className="signature-font text-xl text-slate-800">{role==='Landlord' && signed ? LANDLORDS[p.landlord].name : (role==='Tenant' ? LANDLORDS[p.landlord].name : '')}</div>
                                }
                            </div>
                            <div className="flex-1 text-center p-2 border rounded border-dashed border-blue-200 bg-blue-50">
                                <div className="text-[9px] uppercase text-blue-400">Tenant</div>
                                {role==='Tenant' && !signed ? 
                                    <button onClick={onSign} className="text-xs bg-blue-600 text-white px-3 py-1 rounded mt-1 animate-pulse">Sign Here</button> : 
                                    <div className="signature-font text-xl text-blue-600 transform -rotate-3">{role==='Tenant' && signed ? TENANT.name : (role==='Landlord' ? TENANT.name : '')}</div>
                                }
                            </div>
                        </div>
                        {signed && (
                            <button onClick={onAction} className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold shadow-lg">
                                {role === 'Tenant' ? 'Submit Offer' : 'Approve & Countersign'}
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const PropertyDetails = ({ p, onApply, onClose }) => {
            const l = LANDLORDS[p.landlord];
            return (
                <div className="h-full flex flex-col bg-white">
                    <div className="relative h-64 md:h-80">
                        <img src={p.img} className="w-full h-full object-cover" />
                        <button onClick={onClose} className="absolute top-4 right-4 bg-white/50 p-2 rounded-full hover:bg-white transition"><i className="fas fa-times"></i></button>
                        <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/80 to-transparent p-6 pt-20 text-white">
                            <h2 className="text-2xl font-bold">{p.title}</h2>
                            <p className="opacity-90"><i className="fas fa-map-marker-alt"></i> {p.loc}</p>
                        </div>
                    </div>
                    <div className="flex-1 p-6 overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <div><div className="text-xs text-slate-500 uppercase">Monthly Rent</div><div className="text-2xl font-bold text-emerald-600">{p.price} OMR</div></div>
                            <div className="flex gap-4 text-center text-slate-600">
                                <div><i className="fas fa-bed block text-lg mb-1"></i><span className="text-xs font-bold">{p.beds}</span></div>
                                <div><i className="fas fa-bath block text-lg mb-1"></i><span className="text-xs font-bold">{p.baths}</span></div>
                                <div><i className="fas fa-ruler block text-lg mb-1"></i><span className="text-xs font-bold">{p.area}</span></div>
                            </div>
                        </div>
                        <div className="bg-slate-50 p-4 rounded-xl border mb-6 flex items-center gap-3">
                            <img src={l.avatar} className="w-12 h-12 rounded-full border-2 border-white shadow" />
                            <div className="flex-1">
                                <div className="font-bold text-sm">{l.name}</div>
                                <div className="text-xs text-emerald-600 font-bold">Verified Owner</div>
                            </div>
                            <div className="text-yellow-500 font-bold text-sm"><i className="fas fa-star"></i> {l.rating}</div>
                        </div>
                        <h3 className="font-bold mb-2">Description</h3>
                        <p className="text-sm text-slate-600 leading-relaxed mb-10">Premium residential unit with modern finishing. Central AC, built-in wardrobes, and covered parking included. Direct access to community pool and gym.</p>
                    </div>
                    <div className="p-4 border-t safe-bottom">
                        <button onClick={onApply} className="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-4 rounded-xl font-bold shadow-lg flex justify-center items-center gap-2">
                            Apply & Auto-Fill Contract <i className="fas fa-bolt"></i>
                        </button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [role, setRole] = useState('Tenant');
            const [view, setView] = useState('home');
            const [selectedP, setSelectedP] = useState(null);
            
            // Flow States
            const [activeSheet, setActiveSheet] = useState(null); // 'details', 'upload', 'contract'
            const [appStep, setAppStep] = useState(0); // 0:None, 1:Pending, 2:Approved, 3:Paid
            const [uploading, setUploading] = useState(false);
            const [tenantSigned, setTenantSigned] = useState(false);
            const [landlordSigned, setLandlordSigned] = useState(false);

            // Handlers
            const openProp = (p) => { setSelectedP(p); setActiveSheet('details'); };
            const startApply = () => setActiveSheet('upload');
            
            const doUpload = () => { 
                setUploading(true); 
                setTimeout(() => { setUploading(false); setActiveSheet('contract'); }, 1500); 
            };
            
            const submitOffer = () => { 
                setAppStep(1); setActiveSheet(null); 
                alert("Offer sent to Landlord!"); 
            };

            const approveOffer = () => {
                setLandlordSigned(true);
                setAppStep(2); setActiveSheet(null);
                alert("Approved! Tenant notified to pay.");
            };

            const payRent = () => { setAppStep(3); };

            return (
                <div className={`h-full flex flex-col ${role==='Landlord' ? 'bg-slate-900' : 'bg-gray-50'}`}>
                    <Navbar role={role} setRole={setRole} setView={setView} />

                    <div className="flex-1 overflow-y-auto no-scrollbar relative p-4">
                        
                        {/* VIEW: HOME */}
                        {view === 'home' && (
                            <>
                                {role === 'Landlord' && (
                                    <div className="mb-6 p-6 bg-gradient-to-r from-blue-600 to-blue-800 rounded-2xl text-white shadow-lg">
                                        <div className="text-xs opacity-75 uppercase font-bold mb-1">Total Revenue</div>
                                        <div className="text-3xl font-bold mb-2">1,200 OMR</div>
                                        <div className="text-xs bg-white/20 inline-block px-2 py-1 rounded">100% Occupancy</div>
                                    </div>
                                )}
                                
                                {role === 'Tenant' && <h2 className="text-xl font-bold mb-4 text-slate-800">Featured Homes</h2>}
                                {role === 'Landlord' && <h2 className="text-xl font-bold mb-4 text-white">Your Portfolio</h2>}
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20">
                                    {PROPERTIES.map(p => <PropertyCard key={p.id} p={p} onClick={openProp} role={role} />)}
                                </div>
                            </>
                        )}

                        {/* VIEW: APPS / REQUESTS */}
                        {view === 'apps' && (
                            <div className="max-w-xl mx-auto pt-4">
                                <h2 className={`text-xl font-bold mb-6 ${role==='Landlord'?'text-white':'text-slate-800'}`}>{role==='Landlord'?'Incoming Requests':'My Applications'}</h2>
                                
                                {/* EMPTY STATE */}
                                {appStep === 0 && <div className="text-center text-slate-400 py-10">No active applications.</div>}

                                {/* ACTIVE CARD */}
                                {appStep > 0 && selectedP && (
                                    <div className="bg-white rounded-xl shadow p-5 border border-slate-200 relative overflow-hidden">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="flex gap-3">
                                                <img src={selectedP.img} className="w-16 h-16 rounded-lg object-cover" />
                                                <div>
                                                    <div className="font-bold text-slate-800">{selectedP.title}</div>
                                                    <div className="text-xs text-slate-500">Contract #WQ-881</div>
                                                </div>
                                            </div>
                                            {/* STAMP */}
                                            {appStep === 3 && <div className="absolute top-4 right-4 stamp-active border-2 border-emerald-700 text-emerald-700 text-[9px] font-black uppercase p-1 text-center rotate-12 rounded">Registered<br/>Executive<br/>Instrument</div>}
                                        </div>

                                        {/* STEPS */}
                                        {role === 'Tenant' && (
                                            <>
                                                {appStep === 1 && <div className="bg-yellow-50 text-yellow-700 p-2 rounded text-xs font-bold text-center">Waiting for Landlord Signature</div>}
                                                {appStep === 2 && (
                                                    <div className="text-center">
                                                        <div className="text-sm text-emerald-600 font-bold mb-2">Contract Approved!</div>
                                                        <button onClick={payRent} className="w-full bg-emerald-600 text-white py-3 rounded-lg font-bold shadow animate-bounce">Pay & Activate</button>
                                                    </div>
                                                )}
                                                {appStep === 3 && <div className="bg-emerald-50 text-emerald-700 p-2 rounded text-xs font-bold text-center"><i className="fas fa-check-circle"></i> Active • Direct Debit On</div>}
                                            </>
                                        )}

                                        {role === 'Landlord' && (
                                            <>
                                                {appStep === 1 && (
                                                    <div className="text-center">
                                                        <div className="text-xs text-slate-500 mb-2">New offer from Sara Khan (Mala'a: 720)</div>
                                                        <button onClick={() => setActiveSheet('contract')} className="w-full bg-blue-600 text-white py-2 rounded-lg text-xs font-bold">Review & Sign</button>
                                                    </div>
                                                )}
                                                {appStep >= 2 && <div className="bg-green-50 text-green-700 p-2 rounded text-xs font-bold text-center">Active • Waiting for Payment</div>}
                                            </>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* MODAL / SHEET LOGIC */}
                    {activeSheet && (
                        <>
                            {/* BACKDROP */}
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 fade-in" onClick={() => setActiveSheet(null)}></div>
                            
                            {/* SHEET CONTENT */}
                            <div className="mobile-sheet md:desktop-modal md:bg-transparent md:shadow-none md:pointer-events-none slide-up">
                                <div className="md:desktop-modal-content md:pointer-events-auto bg-white h-full">
                                    
                                    {activeSheet === 'details' && <PropertyDetails p={selectedP} onApply={startApply} onClose={() => setActiveSheet(null)} />}
                                    
                                    {activeSheet === 'upload' && (
                                        <div className="p-8 text-center h-full flex flex-col justify-center">
                                            <div className="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6"><i className="fas fa-id-card text-4xl text-blue-500"></i></div>
                                            <h2 className="text-2xl font-bold mb-2">Verification</h2>
                                            <p className="text-slate-500 text-sm mb-8">Upload your Mala'a Report to auto-fill the contract.</p>
                                            <button onClick={doUpload} disabled={uploading} className="w-full py-4 border-2 border-dashed border-blue-300 text-blue-600 font-bold rounded-xl active:bg-blue-50 transition">
                                                {uploading ? <i className="fas fa-spinner fa-spin"></i> : 'Tap to Upload PDF'}
                                            </button>
                                        </div>
                                    )}

                                    {activeSheet === 'contract' && (
                                        <ContractView 
                                            p={selectedP} 
                                            role={role} 
                                            autoFill={role === 'Tenant'} // Only animate for tenant
                                            signed={role === 'Tenant' ? tenantSigned : landlordSigned}
                                            onSign={() => role === 'Tenant' ? setTenantSigned(true) : setLandlordSigned(true)}
                                            onAction={role === 'Tenant' ? submitOffer : approveOffer}
                                            onClose={() => setActiveSheet(null)}
                                        />
                                    )}
                                </div>
                            </div>
                        </>
                    )}

                    <BottomNav view={view} setView={setView} role={role} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
