<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wathiq.om Mobile</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Kufi+Arabic:wght@400;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Kufi Arabic', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Mobile Specifics */
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .mm-input { width: 100%; border: 1px solid #e2e8f0; padding: 8px; font-size: 13px; background: #fff; color: #334155; border-radius: 8px; height: 36px; }
        .mm-label { font-size: 11px; font-weight: 600; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 4px; }
        .typing { background-color: #f0fdf4; border-color: #4ade80; transition: background 0.3s; }
        .signature-font { font-family: 'Dancing Script', cursive; font-size: 1.5rem; }
        .stamp-active { opacity: 0.9; transform: scale(1) rotate(-12deg); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body class="bg-gray-100 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DATA (Same as V17) ---
        const TENANT = { 
            name: "Sara Khan", id: "CV99281", mobile: "99887766", email: "sara.khan@gmail.com", 
            avatar: "https://ui-avatars.com/api/?name=Sara+Khan&background=db2777&color=fff",
            rating: 4.8, sector: "Private Sector", nationality: "Expat",
            reviews: [{ user: "Landlord X", comment: "Paid on time." }]
        };
        const LANDLORDS = {
            'Ahmed': { name: "Ahmed Al-Harthi", id: "CV111", mobile: "99112233", avatar: "https://ui-avatars.com/api/?name=Ahmed+Harthi&background=0f172a&color=fff", rating: 4.9, verified: true, reviews: [{user:"Ali", comment:"Great landlord"}] }
        };
        const PROPERTIES = [
            { id: 1, landlord: 'Ahmed', title: "Sea View 2BHK", price: 600, beds: 2, baths: 3, area: 145, loc: "Al Mouj", img: "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=800&q=80", type: "Apt" },
            { id: 2, landlord: 'Ahmed', title: "Muscat Hills Villa", price: 950, beds: 4, baths: 5, area: 350, loc: "Muscat Hills", img: "https://images.unsplash.com/photo-1600596542815-2250651d2116?auto=format&fit=crop&w=800&q=80", type: "Villa" },
            { id: 3, landlord: 'Ahmed', title: "Azaiba Studio", price: 300, beds: 1, baths: 1, area: 75, loc: "Azaiba", img: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?auto=format&fit=crop&w=800&q=80", type: "Studio" }
        ];

        // --- COMPONENTS ---

        const Header = ({ title, back, onBack, rightIcon }) => (
            <div className="bg-white px-4 pt-12 pb-4 flex justify-between items-center shadow-sm sticky top-0 z-20">
                {back ? <button onClick={onBack}><i className="fas fa-chevron-left text-lg text-slate-600"></i></button> : <div className="w-4"></div>}
                <h1 className="font-bold text-lg">{title}</h1>
                <div className="w-4">{rightIcon}</div>
            </div>
        );

        const BottomNav = ({ active, onNav, role }) => (
            <div className="fixed bottom-0 w-full bg-white border-t border-slate-200 flex justify-around items-center pb-6 pt-3 z-30 safe-area-bottom">
                <button onClick={() => onNav('home')} className={`flex flex-col items-center ${active === 'home' ? 'text-emerald-600' : 'text-slate-400'}`}>
                    <i className="fas fa-home text-xl mb-1"></i><span className="text-[10px] font-medium">Home</span>
                </button>
                <button onClick={() => onNav('apps')} className={`flex flex-col items-center ${active === 'apps' ? 'text-emerald-600' : 'text-slate-400'}`}>
                    <i className="fas fa-file-contract text-xl mb-1"></i><span className="text-[10px] font-medium">{role === 'Tenant' ? 'My Apps' : 'Requests'}</span>
                </button>
                <button onClick={() => onNav('profile')} className={`flex flex-col items-center ${active === 'profile' ? 'text-emerald-600' : 'text-slate-400'}`}>
                    <i className="fas fa-user text-xl mb-1"></i><span className="text-[10px] font-medium">Profile</span>
                </button>
            </div>
        );

        const PropertyCard = ({ p, onClick }) => (
            <div onClick={() => onClick(p)} className="bg-white rounded-2xl overflow-hidden shadow-sm mb-4">
                <div className="h-40 relative">
                    <img src={p.img} className="w-full h-full object-cover" />
                    <div className="absolute bottom-2 left-2 bg-slate-900/80 text-white px-2 py-1 rounded text-xs font-bold">{p.price} OMR</div>
                    <div className="absolute top-2 right-2 bg-white/90 px-2 py-1 rounded-full text-[10px] font-bold text-emerald-600 flex items-center gap-1"><i className="fas fa-check-circle"></i> Verified</div>
                </div>
                <div className="p-4">
                    <h3 className="font-bold text-base mb-1">{p.title}</h3>
                    <p className="text-xs text-slate-500 mb-3"><i className="fas fa-map-marker-alt mr-1"></i> {p.loc}</p>
                    <div className="flex justify-between text-xs text-slate-600 border-t pt-3">
                        <span><i className="fas fa-bed"></i> {p.beds}</span>
                        <span><i className="fas fa-bath"></i> {p.baths}</span>
                        <span><i className="fas fa-ruler"></i> {p.area}mÂ²</span>
                    </div>
                </div>
            </div>
        );

        const PropertySheet = ({ p, onClose, onApply }) => (
            <div className="fixed inset-0 z-50 flex flex-col justify-end bg-black/50 backdrop-blur-sm fade-in">
                <div onClick={onClose} className="flex-1"></div>
                <div className="bg-white rounded-t-3xl h-[85vh] overflow-y-auto slide-up relative">
                    <img src={p.img} className="w-full h-64 object-cover" />
                    <button onClick={onClose} className="absolute top-4 right-4 bg-white/30 p-2 rounded-full text-white"><i className="fas fa-times"></i></button>
                    <div className="p-6">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h2 className="text-2xl font-bold">{p.title}</h2>
                                <p className="text-slate-500 text-sm"><i className="fas fa-map-marker-alt mr-1"></i> {p.loc}</p>
                            </div>
                            <div className="text-emerald-600 font-bold text-xl">{p.price} OMR</div>
                        </div>
                        
                        <div className="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-6 flex items-center gap-3">
                            <img src={LANDLORDS[p.landlord].avatar} className="w-10 h-10 rounded-full" />
                            <div className="flex-1">
                                <div className="font-bold text-sm">{LANDLORDS[p.landlord].name}</div>
                                <div className="text-xs text-emerald-600"><i className="fas fa-badge-check"></i> Verified Owner</div>
                            </div>
                            <div className="text-yellow-500 text-xs font-bold"><i className="fas fa-star"></i> {LANDLORDS[p.landlord].rating}</div>
                        </div>

                        <h3 className="font-bold mb-2">Description</h3>
                        <p className="text-sm text-slate-600 leading-relaxed mb-20">
                            Modern apartment with sea views. Includes gym access and covered parking. Perfect for professionals.
                        </p>
                    </div>
                    <div className="absolute bottom-0 w-full bg-white border-t p-4 safe-area-bottom">
                        <button onClick={onApply} className="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold shadow-lg">Apply Now</button>
                    </div>
                </div>
            </div>
        );

        const ContractMobile = ({ p, onSign, signed, role, autoFill }) => {
            const [fields, setFields] = useState({});
            
            useEffect(() => {
                if(autoFill) {
                    const data = {
                        l_name: LANDLORDS[p.landlord].name, l_id: LANDLORDS[p.landlord].id,
                        t_name: TENANT.name, t_id: TENANT.id,
                        rent: p.price + " OMR", loc: p.loc
                    };
                    let delay = 300;
                    Object.keys(data).forEach(k => { setTimeout(() => setFields(prev => ({...prev, [k]: data[k]})), delay); delay+=100; });
                } else {
                    setFields({ l_name: LANDLORDS[p.landlord].name, t_name: TENANT.name, rent: p.price, loc: p.loc });
                }
            }, []);

            return (
                <div className="bg-white p-4 rounded-xl border border-slate-200 text-sm shadow-sm m-4">
                    <div className="text-center border-b pb-4 mb-4">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/Emblem_of_Oman.svg/1200px-Emblem_of_Oman.svg.png" className="h-10 mx-auto opacity-80" />
                        <h3 className="font-bold mt-2">MUNICIPALITY CONTRACT</h3>
                        <div className="text-xs text-emerald-600 font-mono">#WQ-2026-881</div>
                    </div>
                    <div className="space-y-3 mb-6">
                        <div><span className="mm-label">Landlord</span><div className={`mm-input ${fields.l_name && autoFill && 'typing'}`}>{fields.l_name}</div></div>
                        <div><span className="mm-label">Tenant</span><div className={`mm-input ${fields.t_name && autoFill && 'typing'}`}>{fields.t_name}</div></div>
                        <div className="grid grid-cols-2 gap-2">
                            <div><span className="mm-label">Rent</span><div className={`mm-input font-bold ${fields.rent && autoFill && 'typing'}`}>{fields.rent}</div></div>
                            <div><span className="mm-label">Loc</span><div className={`mm-input ${fields.loc && autoFill && 'typing'}`}>{fields.loc}</div></div>
                        </div>
                    </div>
                    <div className="border-t pt-4 text-center">
                        <div className="text-xs text-slate-400 uppercase font-bold mb-2">{role} Signature</div>
                        {signed ? 
                            <span className="signature-font text-blue-600 text-xl">{role==='Tenant'?TENANT.name:LANDLORDS[p.landlord].name}</span> :
                            <button onClick={onSign} className="w-full bg-blue-600 text-white py-2 rounded-lg font-bold text-xs animate-pulse">Tap to Sign</button>
                        }
                    </div>
                </div>
            );
        };

        // --- SCREENS ---

        const TenantHome = ({ onPropClick }) => (
            <div className="p-4 pb-24">
                <div className="flex gap-2 overflow-x-auto pb-4 no-scrollbar">
                    <div className="bg-emerald-600 text-white px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap">All Properties</div>
                    <div className="bg-white border px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap">Al Mouj</div>
                    <div className="bg-white border px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap">Muscat Hills</div>
                </div>
                {PROPERTIES.map(p => <PropertyCard key={p.id} p={p} onClick={onPropClick} />)}
            </div>
        );

        const LandlordDash = ({ hasApp, appSigned, onReview }) => (
            <div className="p-4 pb-24">
                <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6">
                    <div className="text-xs text-slate-500 uppercase font-bold">Revenue (Feb)</div>
                    <div className="text-2xl font-bold text-slate-800">1,200 OMR</div>
                    <div className="w-full bg-gray-100 h-1.5 rounded-full mt-2"><div className="bg-emerald-500 h-1.5 rounded-full w-2/3"></div></div>
                </div>
                <h3 className="font-bold text-lg mb-4">Requests</h3>
                {hasApp ? (
                    <div className="bg-white p-4 rounded-xl border border-blue-100 shadow-sm relative overflow-hidden">
                        <div className="absolute top-0 right-0 bg-blue-500 text-white text-[10px] px-2 py-1 rounded-bl font-bold">NEW</div>
                        <div className="flex gap-3 items-center mb-3">
                            <img src={TENANT.avatar} className="w-10 h-10 rounded-full" />
                            <div>
                                <div className="font-bold text-sm">{TENANT.name}</div>
                                <div className="text-xs text-emerald-600 font-bold">Mala'a: 720</div>
                            </div>
                        </div>
                        {appSigned ? 
                            <div className="bg-gray-100 text-center py-2 rounded text-xs font-bold text-gray-500">Contract Sent</div> :
                            <button onClick={onReview} className="w-full bg-emerald-600 text-white py-2 rounded-lg text-xs font-bold">Review & Sign</button>
                        }
                    </div>
                ) : <div className="text-center text-slate-400 text-sm py-10">No pending requests</div>}
            </div>
        );

        const App = () => {
            const [role, setRole] = useState('Tenant');
            const [view, setView] = useState('home'); 
            const [selectedP, setSelectedP] = useState(null);
            const [sheetOpen, setSheetOpen] = useState(false);
            const [appStep, setAppStep] = useState(0); // 0:None, 1:Upload, 2:Contract, 3:Sent
            const [l_Signed, setLSigned] = useState(false);
            const [t_Paid, setTPaid] = useState(false);

            // Handlers
            const startApp = () => { setSheetOpen(false); setAppStep(1); setView('apply'); };
            const uploadMalaa = () => { setTimeout(() => setAppStep(2), 1000); };
            const tenantSign = () => { setAppStep(3); alert("Sent to Landlord!"); setView('home'); };
            const landlordReview = () => { setLSigned(true); alert("Approved & Countersigned!"); };
            const tenantPay = () => { setTPaid(true); alert("Paid! Contract Active."); };

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col">
                    {/* ROLE SWITCHER */}
                    <div className="bg-slate-900 text-white text-[10px] p-2 text-center" onClick={() => setRole(r => r==='Tenant'?'Landlord':'Tenant')}>
                        Current Role: <span className="font-bold text-emerald-400">{role}</span> (Tap to Switch)
                    </div>

                    <Header title={view==='home'?'Wathiq.om':(view==='apply'?'Application':'Dashboard')} back={view!=='home'} onBack={() => setView('home')} />

                    <div className="flex-1 overflow-y-auto no-scrollbar">
                        {role === 'Tenant' && view === 'home' && <TenantHome onPropClick={(p) => { setSelectedP(p); setSheetOpen(true); }} />}
                        
                        {role === 'Landlord' && (view === 'home' || view === 'landlord_dash') && 
                            <LandlordDash hasApp={appStep===3} appSigned={l_Signed} onReview={landlordReview} />
                        }

                        {/* TENANT APPLICATION FLOW */}
                        {view === 'apply' && appStep === 1 && (
                            <div className="p-8 text-center mt-10">
                                <i className="fas fa-id-card text-5xl text-blue-500 mb-4"></i>
                                <h2 className="text-xl font-bold mb-2">Verify Identity</h2>
                                <p className="text-sm text-slate-500 mb-8">Upload Mala'a PDF to auto-fill contract.</p>
                                <button onClick={uploadMalaa} className="w-full py-3 border-2 border-dashed border-blue-300 text-blue-600 font-bold rounded-xl">Select File</button>
                            </div>
                        )}

                        {view === 'apply' && appStep === 2 && (
                            <div>
                                <ContractMobile p={selectedP} role="Tenant" autoFill={true} signed={false} onSign={tenantSign} />
                                <div className="px-4"><button onClick={tenantSign} className="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold shadow">Sign & Send Offer</button></div>
                            </div>
                        )}

                        {/* ACTIVE CONTRACT VIEW */}
                        {role === 'Tenant' && view === 'apps' && (
                            <div className="p-4">
                                <h3 className="font-bold mb-4">My Contracts</h3>
                                {l_Signed ? (
                                    <div className="bg-white p-4 rounded-xl border border-emerald-100 shadow-sm relative overflow-hidden">
                                        {t_Paid && <div className="absolute top-2 right-2 stamp-active text-[10px] font-bold border-2 border-emerald-600 text-emerald-600 p-1 rounded rotate-12">REGISTERED<br/>RD 15/2025</div>}
                                        <div className="font-bold text-lg mb-1">{selectedP.title}</div>
                                        <div className="text-xs text-slate-500 mb-4">{l_Signed && !t_Paid ? "Waiting for Payment" : "Active"}</div>
                                        {!t_Paid ? <button onClick={tenantPay} className="w-full bg-blue-600 text-white py-2 rounded-lg text-xs font-bold">Pay & Activate</button> : <div className="text-center text-xs text-emerald-600 font-bold bg-emerald-50 py-2 rounded">Direct Debit Active</div>}
                                    </div>
                                ) : <div className="text-center text-slate-400 text-sm mt-10">No active contracts</div>}
                            </div>
                        )}
                    </div>

                    {sheetOpen && <PropertySheet p={selectedP} onClose={() => setSheetOpen(false)} onApply={startApp} />}
                    
                    <BottomNav active={view} onNav={(v) => { if(v==='apps' && role==='Landlord') { setView('home'); } else { setView(v); } }} role={role} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
